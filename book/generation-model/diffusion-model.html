
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2. Diffusion Model &#8212; Image generation learning book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/generation-model/diffusion-model';</script>
    <link rel="canonical" href="https://anyiyou11.github.io/Image generation book/book/generation-model/diffusion-model.html" />
    <link rel="icon" href="../../_static/fav.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4. Art by gan" href="../assignments/art-by-gan.html" />
    <link rel="prev" title="1. Generative adversarial networks" href="gan.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Image generation learning book - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Image generation learning book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">IMAGE GENERATION MODEL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gan.html">1. Generative adversarial networks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Diffusion Model</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ASSIGNMENTS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../assignments/art-by-gan.html">4. Art by gan</a></li>

<li class="toctree-l1"><a class="reference internal" href="../assignments/denoising-difussion-model.html">6. Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/anyiyou11/Image generation book/master?urlpath=tree/book/generation-model/diffusion-model.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/anyiyou11/Image generation book/blob/master/book/generation-model/diffusion-model.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/anyiyou11/Image generation book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/anyiyou11/Image generation book/edit/main/book/generation-model/diffusion-model.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/anyiyou11/Image generation book/issues/new?title=Issue%20on%20page%20%2Fbook/generation-model/diffusion-model.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/book/generation-model/diffusion-model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Diffusion Model</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2. Diffusion Model</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">2.1. Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expectation">2.1.1. Expectation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#definition">2.1.1.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#properties">2.1.1.2. Properties</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variance">2.1.2. Variance</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1.2.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1.2.2. Properties</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#re-parameterization-trick">2.1.3. Re-parameterization trick</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-expectation">2.1.3.1. Mean (Expectation)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.1.3.2. Variance</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kl-divergence">2.1.4. KL Divergence</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.1.4.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#jensen-s-inequality">2.1.4.2. Jensen‚Äôs inequality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-kl-divergence">2.1.4.3. Properties of KL Divergence</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evidence-lower-bound-elbo">2.1.5. Evidence lower bound (ELBO)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.1.5.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.1.5.2. Properties</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-and-reverse-process">3. Forward and Reverse Process</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-diffusion-process">3.1. Forward Diffusion Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reverse-diffusion-process">3.2. Reverse Diffusion Process</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loss-function">3.2.1. Loss Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#noise-schedule">3.2.2. Noise schedule</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-schedule">3.2.2.1. Linear schedule</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cosine-schedule">3.2.2.2. Cosine schedule</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code">3.3. Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">3.3.1. Import Libraries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-loading">3.3.2. Data Loading</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">3.3.3. Data Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-augmentation">3.3.4. Data Augmentation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">3.3.5. Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-schedule-beta">3.3.6. Linear schedule-beta</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-turn">3.4. Your turn! üöÄ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgments">3.5. Acknowledgments</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the necessary dependencies</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="o">!{</span>sys.executable<span class="o">}</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--quiet<span class="w"> </span>pandas<span class="w"> </span>scikit-learn<span class="w"> </span>numpy<span class="w"> </span>matplotlib<span class="w"> </span>jupyterlab_myst<span class="w"> </span>ipython<span class="w"> </span>tensorflow_addons<span class="w"> </span>opencv-python<span class="w"> </span>requests
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="diffusion-model">
<h1><span class="section-number">2. </span>Diffusion Model<a class="headerlink" href="#diffusion-model" title="Link to this heading">#</a></h1>
<p>Diffusion model in deep learning is a type of generative model. The core idea of this model is to generate data by gradually adding noise. Specifically, diffusion models achieve data generation through two processes: diffusion process and inverse diffusion process.</p>
<p>Forward Diffusion Process: In this process, the model gradually adds noise to the data, making it increasingly random and unpredictable.
Reverse Diffusion Process: This process attempts to gradually remove the added noise, gradually restoring the data to its original state.</p>
<p>By alternately applying these two processes, diffusion models can generate high-quality data samples.</p>
<img src="https://static-1300131294.cos.ap-shanghai.myqcloud.com/images/deep-learning/diffusion-model/04_frdiffusion.png" width="90%" class="bg-white mb-1">
<section id="background">
<h2><span class="section-number">2.1. </span>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>Before we learn the diffusion model, we have to know some background knowledge in statistics. Perhaps you already have a good mastery of them, let‚Äôs review them together.</p>
<section id="expectation">
<h3><span class="section-number">2.1.1. </span>Expectation<a class="headerlink" href="#expectation" title="Link to this heading">#</a></h3>
<section id="definition">
<h4><span class="section-number">2.1.1.1. </span>Definition<a class="headerlink" href="#definition" title="Link to this heading">#</a></h4>
<p>In probability theory, expectation (also called expected value, mean, average) is a generalization of the weighted average.</p>
<p><span class="math notranslate nohighlight">\(E[X] = x_1 p_1 + x_2 p2 + ... +x_n p_n = \sum_{i=1}^n x_i p_1\)</span></p>
<p>where <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(p_i\)</span> are i-th a possible outcome and its probability, respectively.</p>
</section>
<section id="properties">
<h4><span class="section-number">2.1.1.2. </span>Properties<a class="headerlink" href="#properties" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E[aX]=aE[X]\)</span> where a is a constant value.</p></li>
<li><p><span class="math notranslate nohighlight">\(E[X+b]=E[X]+b\)</span> where b is a constant value.</p></li>
<li><p><span class="math notranslate nohighlight">\(E[X+Y]=E[X]+E[Y]\)</span>.</p></li>
</ul>
</section>
</section>
<section id="variance">
<h3><span class="section-number">2.1.2. </span>Variance<a class="headerlink" href="#variance" title="Link to this heading">#</a></h3>
<p>Variance is a measure of dispersion, meaning it is a measure of how far a set of numbers is spread out from their average value.</p>
<section id="id1">
<h4><span class="section-number">2.1.2.1. </span>Definition<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>The variance of a random variable <span class="math notranslate nohighlight">\(X\)</span> is the expected value of the squared deviation from the expectation of <span class="math notranslate nohighlight">\(X\)</span>.</p>
</section>
<section id="id2">
<h4><span class="section-number">2.1.2.2. </span>Properties<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Var[X]=E[X^2]‚àíE[X]^2\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(Var[aX]=a^2 Var[X]\)</span> where a is a constant value.</p></li>
<li><p><span class="math notranslate nohighlight">\(Var[X+b]=Var[X]\)</span> where b is a constant value.</p></li>
<li><p><span class="math notranslate nohighlight">\(Var[X+Y]=Var[X]+Var[Y]\)</span>.</p></li>
</ul>
</section>
</section>
<section id="re-parameterization-trick">
<h3><span class="section-number">2.1.3. </span>Re-parameterization trick<a class="headerlink" href="#re-parameterization-trick" title="Link to this heading">#</a></h3>
<p>When we sample data from a probability distribution, backpropagation the gradient is not possible because it is a stochastic process. To make it trainable, the re-parameterization trick is useful.</p>
<p>Let us assume that <span class="math notranslate nohighlight">\(z\)</span> is sampled data from a gaussian distribution which the mean is <span class="math notranslate nohighlight">\(\mu\)</span> and the variance is <span class="math notranslate nohighlight">\(\sigma^2\)</span>. Then, the mean and variance of <span class="math notranslate nohighlight">\(z\)</span> would be <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma^2\)</span>. Therefore, <span class="math notranslate nohighlight">\(z\)</span> can be written as follows.</p>
<p><span class="math notranslate nohighlight">\(z = N(\mu, \sigma^2 I) = \mu + \sigma \odot \epsilon\)</span>, where <span class="math notranslate nohighlight">\(\epsilon \thicksim N(0, I)\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\odot\)</span> refers to element-wise product.</p>
<p>The mean and variance of <span class="math notranslate nohighlight">\(z\)</span> correspond to <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma^2\)</span>, respectively.</p>
<section id="mean-expectation">
<h4><span class="section-number">2.1.3.1. </span>Mean (Expectation)<a class="headerlink" href="#mean-expectation" title="Link to this heading">#</a></h4>
<p><span class="math notranslate nohighlight">\(E[z] = E[\mu+\sigma \odot \epsilon] = E[\mu] + \sigma E[\epsilon] = \mu\)</span></p>
<p>The expectation of <span class="math notranslate nohighlight">\(\epsilon\)</span> is 0 by definition.</p>
</section>
<section id="id3">
<h4><span class="section-number">2.1.3.2. </span>Variance<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<p><span class="math notranslate nohighlight">\(Var[z] = Var[\mu + \sigma \odot \epsilon] = Var[\sigma \odot \epsilon] = \sigma^2 Var[\epsilon] = \sigma^2\)</span></p>
<p>The variance of \epsilon is 1 by definition.</p>
</section>
</section>
<section id="kl-divergence">
<h3><span class="section-number">2.1.4. </span>KL Divergence<a class="headerlink" href="#kl-divergence" title="Link to this heading">#</a></h3>
<p>In mathematical statistics, the Kullback‚ÄìLeibler divergence (relative entropy), is a type of statistical distance.</p>
<section id="id4">
<h4><span class="section-number">2.1.4.1. </span>Definition<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<ol class="arabic simple">
<li><p>Discrete probability distribution</p></li>
</ol>
<p><span class="math notranslate nohighlight">\(D_{KL}(P||Q) = \sum_{x \in X} P(x) log \frac{P(x)}{Q(x)}\)</span>,where <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> are discrete probability distributions.</p>
<ol class="arabic simple" start="2">
<li><p>Continuous probability distribution</p></li>
</ol>
<p><span class="math notranslate nohighlight">\(D_{KL} (P||Q) = \int _{‚àí \infty}^{\infty} p(x) log \frac{p(x)}{q(x)}dx\)</span>, where <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> denote the probability densities of <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span>.</p>
</section>
<section id="jensen-s-inequality">
<h4><span class="section-number">2.1.4.2. </span>Jensen‚Äôs inequality<a class="headerlink" href="#jensen-s-inequality" title="Link to this heading">#</a></h4>
<p>In mathematics, Jensen‚Äôs inequality relates the value of a convex (or concave) function of an integral to the integral of the function.</p>
<ul class="simple">
<li><p>Convex function: <span class="math notranslate nohighlight">\(f(E[X]) \leqq E[f(X)]\)</span>;</p></li>
<li><p>Concave function: <span class="math notranslate nohighlight">\(f(E[X]) \geqq E[f(X)]\)</span>.</p></li>
</ul>
</section>
<section id="properties-of-kl-divergence">
<h4><span class="section-number">2.1.4.3. </span>Properties of KL Divergence<a class="headerlink" href="#properties-of-kl-divergence" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>KL Divergence is always non-negative;</p></li>
<li><p>The cross-entropy is always larger than the entropy;</p></li>
<li><p>Two univariate normal distributions <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> are simplified to <span class="math notranslate nohighlight">\(D_{KL}(P||Q) = log \frac{\sigma_q}{\sigma_p} + \frac{\sigma^2_p + (\mu_p ‚àí \mu_q)^2}{2\sigma^2_q} ‚àí \frac{1}{2}\)</span>.</p></li>
</ul>
</section>
</section>
<section id="evidence-lower-bound-elbo">
<h3><span class="section-number">2.1.5. </span>Evidence lower bound (ELBO)<a class="headerlink" href="#evidence-lower-bound-elbo" title="Link to this heading">#</a></h3>
<p>In variational Bayesian methods, the evidence lower bound (often abbreviated ELBO) is a useful lower bound on the log-likelihood of some observed data.</p>
<section id="id5">
<h4><span class="section-number">2.1.5.1. </span>Definition<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<p><span class="math notranslate nohighlight">\(ELBO := E_{z‚àºq_{\phi}}[log \frac{pŒ∏(x,z)}{q_{\phi}(z)}]\)</span></p>
<p>where <span class="math notranslate nohighlight">\(p_{\theta}(x, z)\)</span> is joint distribution of <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(z\)</span>. <span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span> are parameters.</p>
<p>ELBO is used to obtain the lower bound of the evidence (or log evidence). The evidence is the likelihood function evaluated at a fixed <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p><span class="math notranslate nohighlight">\(evidence := log p_{\theta}(x)\)</span></p>
</section>
<section id="id6">
<h4><span class="section-number">2.1.5.2. </span>Properties<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>The evidence is always larger than ELBO;</p></li>
<li><p>KL Divergence between <span class="math notranslate nohighlight">\(p_{\theta}(z|x)\)</span> and <span class="math notranslate nohighlight">\(q_{\phi}(z)\)</span> equals <span class="math notranslate nohighlight">\(evidence‚àíELBO\)</span>.</p></li>
</ul>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="forward-and-reverse-process">
<h1><span class="section-number">3. </span>Forward and Reverse Process<a class="headerlink" href="#forward-and-reverse-process" title="Link to this heading">#</a></h1>
<p>Diffusion models transform data into Gaussian noise (latent vector) and then restore it. The former is called the forward process, and the latter is called the reverse process.</p>
<section id="forward-diffusion-process">
<h2><span class="section-number">3.1. </span>Forward Diffusion Process<a class="headerlink" href="#forward-diffusion-process" title="Link to this heading">#</a></h2>
<p>In the forward process, we add a gaussian noise to the data step by step (usually hundreds of steps).</p>
<p>The transform of an individual step is defined as follows.
<span class="math notranslate nohighlight">\(x_t = q(x_t|x_{t‚àí1}) = N(x_t, \sqrt{1‚àí\beta_t}x_{t‚àí1}, \beta_t I)\)</span></p>
<img src="https://static-1300131294.cos.ap-shanghai.myqcloud.com/images/deep-learning/diffusion-model/05_forward.jpg" width="90%" class="bg-white mb-1">
<p>The forward diffusion process progressively adds Gaussian noise to the input image <span class="math notranslate nohighlight">\(x_0\)</span> over <span class="math notranslate nohighlight">\(T\)</span> steps, producing a series of noisy image samples <span class="math notranslate nohighlight">\(x_1, \ldots, x_T\)</span>.</p>
<p>As <span class="math notranslate nohighlight">\(T \rightarrow \infty\)</span>, the final result will converge to an image fully corrupted by noise, akin to sampling from an isotropic Gaussian distribution.</p>
<p>The inefficiency of Pythonic loops, particularly with large timestamps, can cause significant slowdowns. To address this, we employ a reparameterization trick, which uses an approximation method to generate noise at specific timestamps, avoiding the need for explicit iteration.</p>
<p><span class="math notranslate nohighlight">\(\alpha_t := 1 - \beta_t\)</span>,
<span class="math notranslate nohighlight">\(\bar{\alpha}_t := \prod_{s=1}^{t} \alpha_s\)</span>,
<span class="math notranslate nohighlight">\(q(x_t | x_0) = \mathcal{N}\left( x_t; \sqrt{\bar{\alpha}_t} x_0, (1 - \bar{\alpha}_t) I \right)\)</span></p>
<p>We‚Äôve isolated the variance schedule and calculated the cumulative product of this variable <span class="math notranslate nohighlight">\(Œ±_t\)</span>. This equation allows us to directly sample the noisy image at any time step using just the original image <span class="math notranslate nohighlight">\(( x_0 )\)</span>.</p>
</section>
<section id="reverse-diffusion-process">
<h2><span class="section-number">3.2. </span>Reverse Diffusion Process<a class="headerlink" href="#reverse-diffusion-process" title="Link to this heading">#</a></h2>
<p>In the reverse process, we restore image from a gaussian noise (a latent vector). If <span class="math notranslate nohighlight">\(\beta_t\)</span> is small enough, the reverse <span class="math notranslate nohighlight">\(q(x_{t-1}|x_t)\)</span> will also be gaussian. It is noteworthy that the reverse process is tractable when conditioned on <span class="math notranslate nohighlight">\(x_0\)</span>.</p>
<img src="https://static-1300131294.cos.ap-shanghai.myqcloud.com/images/deep-learning/diffusion-model/01_structure.png" width="90%" class="bg-white mb-1"><p>The forward process is different; we cannot use <span class="math notranslate nohighlight">\(q(x_{t-1}|x_t)\)</span> to reverse the noise because it is difficult (or impossible) to compute. Therefore, we need to train a neural network <span class="math notranslate nohighlight">\(p_Œ∏(x‚Çú‚Çã‚ÇÅ|x‚Çú)\)</span> to approximate <span class="math notranslate nohighlight">\(q(x_{t-1}|x_t)\)</span>.</p>
<p><span class="math notranslate nohighlight">\(p_{\theta}(x_{t-1}|x_{t}) := \mathcal{N}(x_{t-1}; \mu(x_{t}, t), \Sigma_{\theta}(x_{t}, t))\)</span></p>
<p><span class="math notranslate nohighlight">\(p_{\theta}(x_{0:T}) = p_{\theta}(x_{T}) \prod_{t=1}^{T} p_{\theta}(x_{t-1}|x_{t})\)</span></p>
<p><span class="math notranslate nohighlight">\(p_{\theta}(x_{0}) := \int p_{\theta}(x_{0:T}) dx_{1:T}\)</span></p>
<section id="loss-function">
<h3><span class="section-number">3.2.1. </span>Loss Function<a class="headerlink" href="#loss-function" title="Link to this heading">#</a></h3>
<p>In a diffusion model, the goal of the reverse diffusion process is to infer the noise-free original image that generated the observed noisy image. To achieve this, we train a neural network to approximate the inverse of the noise process. The training of this neural network is accomplished by minimizing a loss function.</p>
<p>First,We define loss function using negative log likelihood &amp; ELBO:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\log p_{\theta}(x_0) &amp;= \log p_{\theta}(x_0 | x_{1:T}) + \log p_{\theta}(x_{1:T}) - \log p_{\theta}(x_{1:T} | x_0) \\
\mathbb{E}_{q}[ \log p_{\theta}(x_0) ] &amp;= \int q(x_{1:T} | x_0) \log p_{\theta}(x_0) dx_{1:T} \\
&amp;= \int q(x_{1:T} | x_0) [ \log p_{\theta}(x_0 | x_{1:T}) + \log p_{\theta}(x_{1:T}) - \log p_{\theta}(x_{1:T} | x_0) ] dx_{1:T} \\
&amp;= \mathbb{E}_{q}[ \log p_{\theta}(x_0 | x_{1:T}) ] + \int q(x_{1:T} | x_0) \log p_{\theta}(x_{1:T}) dx_{1:T} \\
&amp;- \int q(x_{1:T} | x_0) \log p_{\theta}(x_{1:T} | x_0) dx_{1:T}
\end{aligned}
\end{split}\]</div>
<p>Then,chenge to tractable form:</p>
<img src="https://static-1300131294.cos.ap-shanghai.myqcloud.com/images/deep-learning/diffusion-model/06_lossformula.png" width="90%" class="bg-white mb-1">
<p>Finally,simplify training objective:</p>
<p>We will use <span class="math notranslate nohighlight">\(D_{KL}(q(x_{t-1} | x_t, x_0) || p_{\theta}(x_{t-1} | x_t) )\)</span> for simplifying the loss function. In the paper, the author trained the model using this part as a training objective.</p>
<p>So, our challenge has been narrowed down to training the two distributions <span class="math notranslate nohighlight">\( q(x_{t-1} | x_t, x_0) \)</span> and <span class="math notranslate nohighlight">\( p_{\theta}(x_{t-1} | x_t) \)</span> as equally as possible.</p>
<div class="math notranslate nohighlight">
\[ q(x_{t-1} | x_t, x_0) = N(x_{t-1}; \hat{\mu}(x_t, x_0), \hat{\beta}I),
 p_{\theta}(x_{t-1} | x_t) = N(x_{t-1}; \mu_{\theta}(x_t, t), \sigma_t^2 I) \]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
D_{KL}(q(x_{t-1} | x_t, x_0) || p_{\theta}(x_{t-1} | x_t)) &amp;= E_{x_0, \epsilon} \left[ \frac{{\beta_t^2}}{{2\sigma_t^2} \alpha_t (1 - \hat{\alpha}_t)} || \epsilon - \epsilon_{\theta}(\sqrt{\hat{\alpha}_t}x_0 + \sqrt{1 - \hat{\alpha}_t} \epsilon, t) ||^2 \right] \\\frac{{\beta_t^2}}{{2\sigma_t^2} \alpha_t (1 - \hat{\alpha}_t)} &amp;\text{ is considered as a constant in the paper}
\end{aligned}
\end{split}\]</div>
<p>Final Loss:
$<span class="math notranslate nohighlight">\(
\begin{aligned}
E_{x_0, \epsilon}[ || \epsilon - \epsilon_{\theta}(\sqrt{\hat{\alpha}_t}x_0 + \sqrt{1 - \hat{\alpha}_t} \epsilon, t) ||^2 ]
\end{aligned}
\)</span>$</p>
</section>
<section id="noise-schedule">
<h3><span class="section-number">3.2.2. </span>Noise schedule<a class="headerlink" href="#noise-schedule" title="Link to this heading">#</a></h3>
<p>In diffusion models, the noise schedule define the methodology for iteratively adding noise to an image or for updating a sample based on model outputs. I‚Äôll introduce two type of schedules which are linear schedule and cosine schedule. The linear and cosine schedule were introduced by <a class="reference external" href="https://arxiv.org/abs/2006.11239">Denoising Diffusion Probabilistic Models</a> and <a class="reference external" href="https://arxiv.org/abs/2006.11239">Improved Denoising Diffusion Probabilistic Models</a>, respectively.</p>
<section id="linear-schedule">
<h4><span class="section-number">3.2.2.1. </span>Linear schedule<a class="headerlink" href="#linear-schedule" title="Link to this heading">#</a></h4>
<p>In the linear schedule, <span class="math notranslate nohighlight">\(\beta_t\)</span> changes linearly.</p>
<img src="https://static-1300131294.cos.ap-shanghai.myqcloud.com/images/deep-learning/diffusion-model/02_linear.png" width="90%" class="bg-white mb-1">
<p>Illustration of linear schedule</p>
</section>
<section id="cosine-schedule">
<h4><span class="section-number">3.2.2.2. </span>Cosine schedule<a class="headerlink" href="#cosine-schedule" title="Link to this heading">#</a></h4>
<p>Alex Nichol and Prafulla Dhariwal proposed the cosine schedule to prevent an image from turning into noise too quickly. They construct a different noise schedule in terms of <span class="math notranslate nohighlight">\(\overline{\alpha_t}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\overline{\alpha_t} = \frac{f(t)}{f(0)}\)</span>, <span class="math notranslate nohighlight">\(f(t) = cos(\frac{\frac{t}{T} + s}{1+s} \frac{\pi}{2})^2\)</span>. By definition, the <span class="math notranslate nohighlight">\(\beta_t\)</span> equals <span class="math notranslate nohighlight">\(1 - \frac{\overline{\alpha_t}}{\overline{\alpha_{t-1}}}\)</span>.</p>
<img src="https://static-1300131294.cos.ap-shanghai.myqcloud.com/images/deep-learning/diffusion-model/03_cosine.png" width="90%" class="bg-white mb-1">
<p>Illustration of cosine schedule</p>
</section>
</section>
</section>
<section id="code">
<h2><span class="section-number">3.3. </span>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h2>
<section id="import-libraries">
<h3><span class="section-number">3.3.1. </span>Import Libraries<a class="headerlink" href="#import-libraries" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Layer</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">Conv2DTranspose</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPool2D</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span>
                                     <span class="n">Flatten</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">BatchNormalization</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">MultiHeadAttention</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">import</span> <span class="nn">tensorflow_addons</span> <span class="k">as</span> <span class="nn">tfa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/tensorflow_addons/utils/tfa_eol_msg.py:23: UserWarning: 

TensorFlow Addons (TFA) has ended development and introduction of new features.
TFA has entered a minimal maintenance and release mode until a planned end of life in May 2024.
Please modify downstream libraries to take dependencies from other repositories in our TensorFlow community (e.g. Keras, Keras-CV, and Keras-NLP). 

For more information see: https://github.com/tensorflow/addons/issues/2807 

  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">TIME_STEPS</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">IM_SHAPE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">N_HEADS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">ATTN_DIM</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">N_GROUPS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">N_RESNETS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">LEARNING_RATE</span> <span class="o">=</span> <span class="mf">2e-4</span>
<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">FACTOR</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-loading">
<h3><span class="section-number">3.3.2. </span>Data Loading<a class="headerlink" href="#data-loading" title="Link to this heading">#</a></h3>
<p>The dataset can be downloaded from <a class="reference external" href="https://www.kaggle.com/datasets/jessicali9530/celeba-dataset">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://static-1300131294.cos.ap-shanghai.myqcloud.com/data/deep-learning/diffusion-model/archive.zip&#39;</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_train</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">image_dataset_from_directory</span><span class="p">(</span>
    <span class="s2">&quot;t/celebA&quot;</span><span class="p">,</span> <span class="n">label_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="n">IM_SHAPE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">IM_SHAPE</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 30000 files belonging to 1 classes.
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preprocessing">
<h3><span class="section-number">3.3.3. </span>Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">127.5</span> <span class="o">-</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-augmentation">
<h3><span class="section-number">3.3.4. </span>Data Augmentation<a class="headerlink" href="#data-augmentation" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">augmentation</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">random_flip_left_right</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data">
<h3><span class="section-number">3.3.5. </span>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_train</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">preprocess</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">augmentation</span><span class="p">)</span>
    <span class="o">.</span><span class="n">unbatch</span><span class="p">()</span>
    <span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">reshuffle_each_iteration</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span><span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-schedule-beta">
<h3><span class="section-number">3.3.6. </span>Linear schedule-beta<a class="headerlink" href="#linear-schedule-beta" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">linear_beta_schedule</span><span class="p">(</span><span class="n">timesteps</span><span class="p">):</span>
    <span class="n">beta_start</span> <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="n">beta_end</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">beta_start</span><span class="p">,</span> <span class="n">beta_end</span><span class="p">,</span> <span class="n">timesteps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">betas</span> <span class="o">=</span> <span class="n">linear_beta_schedule</span><span class="p">(</span><span class="n">TIME_STEPS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">betas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tf.Tensor(
[9.99999975e-05 1.19919918e-04 1.39839831e-04 1.59759758e-04
 1.79679686e-04 1.99599599e-04 2.19519512e-04 2.39439454e-04
 2.59359367e-04 2.79279280e-04 2.99199193e-04 3.19119135e-04
 3.39039048e-04 3.58958961e-04 3.78878904e-04 3.98798817e-04
 4.18718730e-04 4.38638643e-04 4.58558556e-04 4.78478498e-04
 4.98398382e-04 5.18318324e-04 5.38238266e-04 5.58158150e-04
 5.78078092e-04 5.97998034e-04 6.17917918e-04 6.37837860e-04
 6.57757802e-04 6.77677686e-04 6.97597628e-04 7.17517512e-04
 7.37437455e-04 7.57357397e-04 7.77277281e-04 7.97197223e-04
 8.17117107e-04 8.37037049e-04 8.56956991e-04 8.76876875e-04
 8.96796817e-04 9.16716759e-04 9.36636643e-04 9.56556585e-04
 9.76476527e-04 9.96396411e-04 1.01631635e-03 1.03623618e-03
 1.05615612e-03 1.07607606e-03 1.09599601e-03 1.11591583e-03
 1.13583577e-03 1.15575572e-03 1.17567566e-03 1.19559560e-03
 1.21551554e-03 1.23543537e-03 1.25535531e-03 1.27527525e-03
 1.29519519e-03 1.31511514e-03 1.33503496e-03 1.35495490e-03
 1.37487485e-03 1.39479479e-03 1.41471473e-03 1.43463456e-03
 1.45455450e-03 1.47447444e-03 1.49439438e-03 1.51431432e-03
 1.53423415e-03 1.55415409e-03 1.57407403e-03 1.59399398e-03
 1.61391392e-03 1.63383386e-03 1.65375369e-03 1.67367363e-03
 1.69359357e-03 1.71351351e-03 1.73343346e-03 1.75335328e-03
 1.77327322e-03 1.79319317e-03 1.81311311e-03 1.83303305e-03
 1.85295299e-03 1.87287282e-03 1.89279276e-03 1.91271270e-03
 1.93263264e-03 1.95255259e-03 1.97247253e-03 1.99239235e-03
 2.01231241e-03 2.03223224e-03 2.05215230e-03 2.07207212e-03
 2.09199218e-03 2.11191201e-03 2.13183183e-03 2.15175189e-03
 2.17167172e-03 2.19159178e-03 2.21151160e-03 2.23143143e-03
 2.25135149e-03 2.27127131e-03 2.29119137e-03 2.31111120e-03
 2.33103125e-03 2.35095108e-03 2.37087090e-03 2.39079096e-03
 2.41071079e-03 2.43063085e-03 2.45055067e-03 2.47047050e-03
 2.49039056e-03 2.51031038e-03 2.53023044e-03 2.55015027e-03
 2.57007009e-03 2.58999015e-03 2.60990998e-03 2.62983004e-03
 2.64974986e-03 2.66966969e-03 2.68958975e-03 2.70950957e-03
 2.72942963e-03 2.74934946e-03 2.76926928e-03 2.78918934e-03
 2.80910917e-03 2.82902922e-03 2.84894905e-03 2.86886888e-03
 2.88878893e-03 2.90870876e-03 2.92862882e-03 2.94854864e-03
 2.96846847e-03 2.98838853e-03 3.00830835e-03 3.02822841e-03
 3.04814824e-03 3.06806830e-03 3.08798812e-03 3.10790795e-03
 3.12782801e-03 3.14774783e-03 3.16766789e-03 3.18758772e-03
 3.20750754e-03 3.22742760e-03 3.24734743e-03 3.26726749e-03
 3.28718731e-03 3.30710714e-03 3.32702720e-03 3.34694702e-03
 3.36686708e-03 3.38678691e-03 3.40670673e-03 3.42662679e-03
 3.44654662e-03 3.46646667e-03 3.48638650e-03 3.50630633e-03
 3.52622638e-03 3.54614621e-03 3.56606627e-03 3.58598609e-03
 3.60590615e-03 3.62582598e-03 3.64574580e-03 3.66566586e-03
 3.68558569e-03 3.70550575e-03 3.72542557e-03 3.74534540e-03
 3.76526546e-03 3.78518528e-03 3.80510534e-03 3.82502517e-03
 3.84494499e-03 3.86486505e-03 3.88478488e-03 3.90470494e-03
 3.92462453e-03 3.94454459e-03 3.96446465e-03 3.98438424e-03
 4.00430430e-03 4.02422436e-03 4.04414395e-03 4.06406401e-03
 4.08398407e-03 4.10390366e-03 4.12382372e-03 4.14374378e-03
 4.16366337e-03 4.18358343e-03 4.20350349e-03 4.22342354e-03
 4.24334314e-03 4.26326320e-03 4.28318325e-03 4.30310285e-03
 4.32302291e-03 4.34294296e-03 4.36286256e-03 4.38278262e-03
 4.40270267e-03 4.42262273e-03 4.44254233e-03 4.46246238e-03
 4.48238244e-03 4.50230204e-03 4.52222209e-03 4.54214215e-03
 4.56206221e-03 4.58198180e-03 4.60190186e-03 4.62182192e-03
 4.64174151e-03 4.66166157e-03 4.68158163e-03 4.70150122e-03
 4.72142128e-03 4.74134134e-03 4.76126140e-03 4.78118099e-03
 4.80110105e-03 4.82102111e-03 4.84094070e-03 4.86086076e-03
 4.88078082e-03 4.90070041e-03 4.92062047e-03 4.94054053e-03
 4.96046059e-03 4.98038018e-03 5.00030024e-03 5.02022030e-03
 5.04013989e-03 5.06005995e-03 5.07998001e-03 5.09989960e-03
 5.11981966e-03 5.13973972e-03 5.15965978e-03 5.17957937e-03
 5.19949943e-03 5.21941949e-03 5.23933908e-03 5.25925914e-03
 5.27917920e-03 5.29909926e-03 5.31901885e-03 5.33893891e-03
 5.35885897e-03 5.37877856e-03 5.39869862e-03 5.41861868e-03
 5.43853827e-03 5.45845833e-03 5.47837839e-03 5.49829844e-03
 5.51821804e-03 5.53813810e-03 5.55805815e-03 5.57797775e-03
 5.59789781e-03 5.61781786e-03 5.63773746e-03 5.65765752e-03
 5.67757757e-03 5.69749763e-03 5.71741723e-03 5.73733728e-03
 5.75725734e-03 5.77717694e-03 5.79709699e-03 5.81701705e-03
 5.83693665e-03 5.85685670e-03 5.87677676e-03 5.89669682e-03
 5.91661641e-03 5.93653647e-03 5.95645653e-03 5.97637612e-03
 5.99629618e-03 6.01621624e-03 6.03613630e-03 6.05605589e-03
 6.07597595e-03 6.09589601e-03 6.11581560e-03 6.13573566e-03
 6.15565572e-03 6.17557531e-03 6.19549537e-03 6.21541543e-03
 6.23533549e-03 6.25525508e-03 6.27517514e-03 6.29509520e-03
 6.31501479e-03 6.33493485e-03 6.35485491e-03 6.37477450e-03
 6.39469456e-03 6.41461462e-03 6.43453468e-03 6.45445427e-03
 6.47437433e-03 6.49429439e-03 6.51421398e-03 6.53413404e-03
 6.55405410e-03 6.57397415e-03 6.59389375e-03 6.61381381e-03
 6.63373386e-03 6.65365346e-03 6.67357352e-03 6.69349357e-03
 6.71341317e-03 6.73333323e-03 6.75325328e-03 6.77317334e-03
 6.79309294e-03 6.81301299e-03 6.83293305e-03 6.85285265e-03
 6.87277270e-03 6.89269276e-03 6.91261236e-03 6.93253241e-03
 6.95245247e-03 6.97237253e-03 6.99229212e-03 7.01221218e-03
 7.03213224e-03 7.05205183e-03 7.07197189e-03 7.09189195e-03
 7.11181201e-03 7.13173160e-03 7.15165166e-03 7.17157172e-03
 7.19149131e-03 7.21141137e-03 7.23133143e-03 7.25125102e-03
 7.27117108e-03 7.29109114e-03 7.31101120e-03 7.33093079e-03
 7.35085085e-03 7.37077091e-03 7.39069050e-03 7.41061056e-03
 7.43053062e-03 7.45045021e-03 7.47037027e-03 7.49029033e-03
 7.51021039e-03 7.53012998e-03 7.55005004e-03 7.56997010e-03
 7.58988969e-03 7.60980975e-03 7.62972981e-03 7.64964940e-03
 7.66956946e-03 7.68948952e-03 7.70940958e-03 7.72932917e-03
 7.74924923e-03 7.76916929e-03 7.78908888e-03 7.80900894e-03
 7.82892946e-03 7.84884952e-03 7.86876865e-03 7.88868871e-03
 7.90860876e-03 7.92852882e-03 7.94844888e-03 7.96836801e-03
 7.98828807e-03 8.00820813e-03 8.02812818e-03 8.04804824e-03
 8.06796830e-03 8.08788743e-03 8.10780749e-03 8.12772755e-03
 8.14764760e-03 8.16756766e-03 8.18748772e-03 8.20740778e-03
 8.22732691e-03 8.24724697e-03 8.26716702e-03 8.28708708e-03
 8.30700714e-03 8.32692720e-03 8.34684726e-03 8.36676639e-03
 8.38668644e-03 8.40660650e-03 8.42652656e-03 8.44644662e-03
 8.46636668e-03 8.48628674e-03 8.50620586e-03 8.52612592e-03
 8.54604598e-03 8.56596604e-03 8.58588610e-03 8.60580616e-03
 8.62572528e-03 8.64564534e-03 8.66556540e-03 8.68548546e-03
 8.70540552e-03 8.72532558e-03 8.74524564e-03 8.76516476e-03
 8.78508482e-03 8.80500488e-03 8.82492494e-03 8.84484500e-03
 8.86476506e-03 8.88468511e-03 8.90460424e-03 8.92452430e-03
 8.94444436e-03 8.96436442e-03 8.98428448e-03 9.00420453e-03
 9.02412459e-03 9.04404372e-03 9.06396378e-03 9.08388384e-03
 9.10380390e-03 9.12372395e-03 9.14364401e-03 9.16356314e-03
 9.18348320e-03 9.20340326e-03 9.22332332e-03 9.24324337e-03
 9.26316343e-03 9.28308349e-03 9.30300262e-03 9.32292268e-03
 9.34284274e-03 9.36276279e-03 9.38268285e-03 9.40260291e-03
 9.42252297e-03 9.44244210e-03 9.46236216e-03 9.48228221e-03
 9.50220227e-03 9.52212233e-03 9.54204239e-03 9.56196152e-03
 9.58188158e-03 9.60180163e-03 9.62172169e-03 9.64164175e-03
 9.66156181e-03 9.68148187e-03 9.70140100e-03 9.72132105e-03
 9.74124111e-03 9.76116117e-03 9.78108123e-03 9.80100129e-03
 9.82092135e-03 9.84084047e-03 9.86076053e-03 9.88068059e-03
 9.90060065e-03 9.92052071e-03 9.94044077e-03 9.96036083e-03
 9.98027995e-03 1.00002000e-02 1.00201201e-02 1.00400401e-02
 1.00599602e-02 1.00798802e-02 1.00997994e-02 1.01197194e-02
 1.01396395e-02 1.01595595e-02 1.01794796e-02 1.01993997e-02
 1.02193197e-02 1.02392389e-02 1.02591589e-02 1.02790790e-02
 1.02989990e-02 1.03189191e-02 1.03388391e-02 1.03587592e-02
 1.03786783e-02 1.03985984e-02 1.04185184e-02 1.04384385e-02
 1.04583586e-02 1.04782786e-02 1.04981987e-02 1.05181178e-02
 1.05380379e-02 1.05579579e-02 1.05778780e-02 1.05977980e-02
 1.06177181e-02 1.06376372e-02 1.06575573e-02 1.06774773e-02
 1.06973974e-02 1.07173175e-02 1.07372375e-02 1.07571576e-02
 1.07770767e-02 1.07969968e-02 1.08169168e-02 1.08368369e-02
 1.08567569e-02 1.08766770e-02 1.08965971e-02 1.09165162e-02
 1.09364362e-02 1.09563563e-02 1.09762764e-02 1.09961964e-02
 1.10161165e-02 1.10360365e-02 1.10559557e-02 1.10758757e-02
 1.10957958e-02 1.11157158e-02 1.11356359e-02 1.11555560e-02
 1.11754751e-02 1.11953951e-02 1.12153152e-02 1.12352353e-02
 1.12551553e-02 1.12750754e-02 1.12949954e-02 1.13149146e-02
 1.13348346e-02 1.13547547e-02 1.13746747e-02 1.13945948e-02
 1.14145149e-02 1.14344349e-02 1.14543540e-02 1.14742741e-02
 1.14941942e-02 1.15141142e-02 1.15340343e-02 1.15539543e-02
 1.15738735e-02 1.15937935e-02 1.16137136e-02 1.16336336e-02
 1.16535537e-02 1.16734738e-02 1.16933938e-02 1.17133129e-02
 1.17332330e-02 1.17531531e-02 1.17730731e-02 1.17929932e-02
 1.18129132e-02 1.18328333e-02 1.18527524e-02 1.18726725e-02
 1.18925925e-02 1.19125126e-02 1.19324327e-02 1.19523527e-02
 1.19722728e-02 1.19921919e-02 1.20121120e-02 1.20320320e-02
 1.20519521e-02 1.20718721e-02 1.20917922e-02 1.21117113e-02
 1.21316314e-02 1.21515514e-02 1.21714715e-02 1.21913916e-02
 1.22113116e-02 1.22312317e-02 1.22511508e-02 1.22710709e-02
 1.22909909e-02 1.23109110e-02 1.23308310e-02 1.23507511e-02
 1.23706711e-02 1.23905903e-02 1.24105103e-02 1.24304304e-02
 1.24503504e-02 1.24702705e-02 1.24901906e-02 1.25101106e-02
 1.25300298e-02 1.25499498e-02 1.25698699e-02 1.25897899e-02
 1.26097100e-02 1.26296300e-02 1.26495492e-02 1.26694692e-02
 1.26893893e-02 1.27093093e-02 1.27292294e-02 1.27491495e-02
 1.27690695e-02 1.27889886e-02 1.28089087e-02 1.28288288e-02
 1.28487488e-02 1.28686689e-02 1.28885889e-02 1.29085090e-02
 1.29284281e-02 1.29483482e-02 1.29682682e-02 1.29881883e-02
 1.30081084e-02 1.30280284e-02 1.30479485e-02 1.30678676e-02
 1.30877877e-02 1.31077077e-02 1.31276278e-02 1.31475478e-02
 1.31674679e-02 1.31873870e-02 1.32073071e-02 1.32272271e-02
 1.32471472e-02 1.32670673e-02 1.32869873e-02 1.33069074e-02
 1.33268265e-02 1.33467466e-02 1.33666666e-02 1.33865867e-02
 1.34065067e-02 1.34264268e-02 1.34463469e-02 1.34662660e-02
 1.34861860e-02 1.35061061e-02 1.35260262e-02 1.35459462e-02
 1.35658663e-02 1.35857863e-02 1.36057055e-02 1.36256255e-02
 1.36455456e-02 1.36654656e-02 1.36853857e-02 1.37053058e-02
 1.37252249e-02 1.37451449e-02 1.37650650e-02 1.37849851e-02
 1.38049051e-02 1.38248252e-02 1.38447452e-02 1.38646644e-02
 1.38845844e-02 1.39045045e-02 1.39244245e-02 1.39443446e-02
 1.39642647e-02 1.39841847e-02 1.40041038e-02 1.40240239e-02
 1.40439440e-02 1.40638640e-02 1.40837841e-02 1.41037041e-02
 1.41236242e-02 1.41435433e-02 1.41634634e-02 1.41833834e-02
 1.42033035e-02 1.42232236e-02 1.42431436e-02 1.42630627e-02
 1.42829828e-02 1.43029029e-02 1.43228229e-02 1.43427430e-02
 1.43626630e-02 1.43825831e-02 1.44025022e-02 1.44224223e-02
 1.44423423e-02 1.44622624e-02 1.44821825e-02 1.45021025e-02
 1.45220226e-02 1.45419417e-02 1.45618618e-02 1.45817818e-02
 1.46017019e-02 1.46216219e-02 1.46415420e-02 1.46614611e-02
 1.46813812e-02 1.47013012e-02 1.47212213e-02 1.47411413e-02
 1.47610614e-02 1.47809815e-02 1.48009006e-02 1.48208207e-02
 1.48407407e-02 1.48606608e-02 1.48805808e-02 1.49005009e-02
 1.49204209e-02 1.49403401e-02 1.49602601e-02 1.49801802e-02
 1.50001002e-02 1.50200203e-02 1.50399404e-02 1.50598604e-02
 1.50797796e-02 1.50996996e-02 1.51196197e-02 1.51395397e-02
 1.51594598e-02 1.51793798e-02 1.51992990e-02 1.52192190e-02
 1.52391391e-02 1.52590591e-02 1.52789792e-02 1.52988993e-02
 1.53188193e-02 1.53387384e-02 1.53586585e-02 1.53785786e-02
 1.53984986e-02 1.54184187e-02 1.54383387e-02 1.54582588e-02
 1.54781779e-02 1.54980980e-02 1.55180180e-02 1.55379381e-02
 1.55578582e-02 1.55777782e-02 1.55976983e-02 1.56176174e-02
 1.56375375e-02 1.56574585e-02 1.56773776e-02 1.56972986e-02
 1.57172177e-02 1.57371368e-02 1.57570578e-02 1.57769769e-02
 1.57968979e-02 1.58168171e-02 1.58367362e-02 1.58566572e-02
 1.58765763e-02 1.58964973e-02 1.59164164e-02 1.59363355e-02
 1.59562565e-02 1.59761757e-02 1.59960967e-02 1.60160158e-02
 1.60359368e-02 1.60558559e-02 1.60757750e-02 1.60956960e-02
 1.61156151e-02 1.61355361e-02 1.61554553e-02 1.61753763e-02
 1.61952954e-02 1.62152145e-02 1.62351355e-02 1.62550546e-02
 1.62749756e-02 1.62948947e-02 1.63148157e-02 1.63347349e-02
 1.63546540e-02 1.63745750e-02 1.63944941e-02 1.64144151e-02
 1.64343342e-02 1.64542552e-02 1.64741743e-02 1.64940935e-02
 1.65140145e-02 1.65339336e-02 1.65538546e-02 1.65737737e-02
 1.65936947e-02 1.66136138e-02 1.66335329e-02 1.66534539e-02
 1.66733731e-02 1.66932940e-02 1.67132132e-02 1.67331342e-02
 1.67530533e-02 1.67729724e-02 1.67928934e-02 1.68128125e-02
 1.68327335e-02 1.68526527e-02 1.68725736e-02 1.68924928e-02
 1.69124119e-02 1.69323329e-02 1.69522520e-02 1.69721730e-02
 1.69920921e-02 1.70120113e-02 1.70319322e-02 1.70518514e-02
 1.70717724e-02 1.70916915e-02 1.71116125e-02 1.71315316e-02
 1.71514507e-02 1.71713717e-02 1.71912909e-02 1.72112118e-02
 1.72311310e-02 1.72510520e-02 1.72709711e-02 1.72908902e-02
 1.73108112e-02 1.73307303e-02 1.73506513e-02 1.73705705e-02
 1.73904914e-02 1.74104106e-02 1.74303297e-02 1.74502507e-02
 1.74701698e-02 1.74900908e-02 1.75100099e-02 1.75299309e-02
 1.75498500e-02 1.75697692e-02 1.75896902e-02 1.76096093e-02
 1.76295303e-02 1.76494494e-02 1.76693704e-02 1.76892895e-02
 1.77092087e-02 1.77291296e-02 1.77490488e-02 1.77689698e-02
 1.77888889e-02 1.78088099e-02 1.78287290e-02 1.78486481e-02
 1.78685691e-02 1.78884882e-02 1.79084092e-02 1.79283284e-02
 1.79482494e-02 1.79681685e-02 1.79880876e-02 1.80080086e-02
 1.80279277e-02 1.80478487e-02 1.80677678e-02 1.80876870e-02
 1.81076080e-02 1.81275271e-02 1.81474481e-02 1.81673672e-02
 1.81872882e-02 1.82072073e-02 1.82271264e-02 1.82470474e-02
 1.82669666e-02 1.82868876e-02 1.83068067e-02 1.83267277e-02
 1.83466468e-02 1.83665659e-02 1.83864869e-02 1.84064060e-02
 1.84263270e-02 1.84462462e-02 1.84661672e-02 1.84860863e-02
 1.85060054e-02 1.85259264e-02 1.85458455e-02 1.85657665e-02
 1.85856856e-02 1.86056066e-02 1.86255258e-02 1.86454449e-02
 1.86653659e-02 1.86852850e-02 1.87052060e-02 1.87251251e-02
 1.87450461e-02 1.87649652e-02 1.87848844e-02 1.88048054e-02
 1.88247245e-02 1.88446455e-02 1.88645646e-02 1.88844856e-02
 1.89044047e-02 1.89243238e-02 1.89442448e-02 1.89641640e-02
 1.89840849e-02 1.90040041e-02 1.90239232e-02 1.90438442e-02
 1.90637633e-02 1.90836843e-02 1.91036034e-02 1.91235244e-02
 1.91434436e-02 1.91633627e-02 1.91832837e-02 1.92032028e-02
 1.92231238e-02 1.92430429e-02 1.92629639e-02 1.92828830e-02
 1.93028022e-02 1.93227232e-02 1.93426423e-02 1.93625633e-02
 1.93824824e-02 1.94024034e-02 1.94223225e-02 1.94422416e-02
 1.94621626e-02 1.94820818e-02 1.95020027e-02 1.95219219e-02
 1.95418429e-02 1.95617620e-02 1.95816811e-02 1.96016021e-02
 1.96215212e-02 1.96414422e-02 1.96613614e-02 1.96812823e-02
 1.97012015e-02 1.97211206e-02 1.97410416e-02 1.97609607e-02
 1.97808817e-02 1.98008008e-02 1.98207218e-02 1.98406409e-02
 1.98605601e-02 1.98804811e-02 1.99004002e-02 1.99203212e-02
 1.99402403e-02 1.99601613e-02 1.99800804e-02 1.99999996e-02], shape=(1000,), dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alphas</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">betas</span>
<span class="n">alphas_cumprod</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sqrt_alphas_cumprod</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alphas_cumprod</span><span class="p">)</span>
<span class="n">sqrt_one_minus_alphas_cumprod</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">alphas_cumprod</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x_shape</span><span class="p">):</span>
    <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">q_sample</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">noise</span><span class="p">):</span>

    <span class="n">sqrt_alphas_cumprod_t</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">sqrt_alphas_cumprod</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x_start</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">sqrt_one_minus_alphas_cumprod_t</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">sqrt_one_minus_alphas_cumprod</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x_start</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">out_sample</span> <span class="o">=</span> <span class="n">sqrt_alphas_cumprod_t</span> <span class="o">*</span> <span class="n">x_start</span> <span class="o">+</span> <span class="n">sqrt_one_minus_alphas_cumprod_t</span> <span class="o">*</span> <span class="n">noise</span><span class="c1">### x_start=x_0, noise = z</span>
    <span class="k">return</span> <span class="n">out_sample</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PositionalEmbeddings</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span> <span class="o">=</span> <span class="n">dim</span>

    <span class="k">def</span> <span class="nf">get_timestep_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timesteps</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        From Fairseq.</span>
<span class="sd">        Build sinusoidal embeddings.</span>
<span class="sd">        This matches the implementation in tensor2tensor, but differs slightly</span>
<span class="sd">        from the description in Section 3.5 of &quot;Attention Is All You Need&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">half_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10000.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">half_dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">half_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">emb</span><span class="p">)</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">emb</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">emb</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">emb</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">embedding_dim</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">emb</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">emb</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">emb</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestep_embedding</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">res_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">filters</span><span class="p">,</span><span class="n">n_groups</span><span class="p">,</span><span class="n">temb</span><span class="p">):</span>
    <span class="n">previous</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,)(</span><span class="n">x</span><span class="p">)</span> <span class="c1">### Convolution layer with padding same, so that the resolution remains the same</span>

    <span class="c1">### temb represents the time embedding.</span>
    <span class="c1">### It is passed into the silu activation function and a Dense Layer(Which can change the the embedding dimension )</span>
    <span class="c1">### We also reshape the time embedding to match the output of 2d convnets.</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">filters</span><span class="p">)(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">silu</span><span class="p">(</span><span class="n">temb</span><span class="p">))[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="c1">### Group Normalization is used.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">silu</span><span class="p">(</span><span class="n">tfa</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GroupNormalization</span><span class="p">(</span><span class="n">n_groups</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,)(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Project residual</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,)(</span><span class="n">previous</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">residual</span><span class="p">])</span>  <span class="c1"># Add back residual</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">im_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">n_resnets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_groups</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">attn_dim</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,):</span>
    <span class="n">input_1</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">im_shape</span><span class="p">)</span><span class="c1">### image input</span>
    <span class="n">input_2</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">())</span><span class="c1">### time input</span>
    <span class="n">t_dim</span> <span class="o">=</span> <span class="n">im_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">16</span>

    <span class="c1"># Entry block</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)(</span><span class="n">input_1</span><span class="p">)</span>
    <span class="n">temb</span> <span class="o">=</span> <span class="n">PositionalEmbeddings</span><span class="p">(</span><span class="n">t_dim</span><span class="p">)(</span><span class="n">input_2</span><span class="p">)</span><span class="c1">### Create embeddings from the time input_2</span>
    <span class="n">temb</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">t_dim</span><span class="p">)(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">gelu</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">t_dim</span><span class="p">)(</span><span class="n">temb</span><span class="p">)))</span><span class="c1">### pass the embedding into the gelu activation function</span>

    <span class="n">hs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="c1">### variable used for storing each resolution level output, in the downward path, to be concatenated to the inputs of the upward path.</span>

    <span class="c1">### Downward Path</span>
    <span class="k">for</span> <span class="n">filters</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">]:</span><span class="c1">### for every resolution level (32,64,128,256), represent the depth they map to resolutions of (32,16,8,4)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_resnets</span><span class="p">):</span><span class="c1">### we go through each resnet block per resolution level</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">res_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">filters</span><span class="p">,</span><span class="n">n_groups</span><span class="p">,</span><span class="n">temb</span><span class="p">)</span><span class="c1">### resblock</span>
            <span class="c1">### if the resolution=16 (coinciding with a depth=64), we make the resnet output features attend to each other.</span>
            <span class="c1">### Note how the attention axes = (1,2). This corresponds to the height and width dimensions.</span>
            <span class="c1">### Feel free to Check the documentation out :) https://www.tensorflow.org/api_docs/python/tf/keras/layers/MultiHeadAttention.</span>
            <span class="c1">### query = key = value = x.</span>
            <span class="c1">### We again use Group Normalization.</span>
            <span class="k">if</span> <span class="n">filters</span> <span class="o">==</span> <span class="mi">64</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">tfa</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GroupNormalization</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">n_groups</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)(</span>
                    <span class="n">MultiHeadAttention</span><span class="p">(</span><span class="n">num_heads</span><span class="o">=</span><span class="n">n_heads</span><span class="p">,</span> <span class="n">key_dim</span><span class="o">=</span><span class="n">attn_dim</span><span class="p">,</span> <span class="n">attention_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">)(</span><span class="n">query</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="c1">### append the output features to hs</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span><span class="c1">### Downsampling in order to move to the next resolution level</span>


    <span class="c1">### Bottleneck</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">res_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="n">n_groups</span><span class="p">,</span><span class="n">temb</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tfa</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GroupNormalization</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">n_groups</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)(</span>
      <span class="n">MultiHeadAttention</span><span class="p">(</span><span class="n">num_heads</span><span class="o">=</span><span class="n">n_heads</span><span class="p">,</span> <span class="n">key_dim</span><span class="o">=</span><span class="n">attn_dim</span><span class="p">,</span> <span class="n">attention_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">)(</span><span class="n">query</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">res_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="n">n_groups</span><span class="p">,</span><span class="n">temb</span><span class="p">)</span>


    <span class="c1">### Upward path</span>
    <span class="k">for</span> <span class="n">filters</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span><span class="mi">32</span><span class="p">]:</span>
        <span class="c1">### we resize x, to match with the shape of feature outputs (hs) in the downward path</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize_with_pad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">hs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">hs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">hs</span><span class="o">.</span><span class="n">pop</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_resnets</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">res_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">filters</span><span class="p">,</span><span class="n">n_groups</span><span class="p">,</span><span class="n">temb</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filters</span> <span class="o">==</span> <span class="mi">64</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">tfa</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GroupNormalization</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">n_groups</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)(</span>
                  <span class="n">MultiHeadAttention</span><span class="p">(</span><span class="n">num_heads</span><span class="o">=</span><span class="n">n_heads</span><span class="p">,</span> <span class="n">key_dim</span><span class="o">=</span><span class="n">attn_dim</span><span class="p">,</span> <span class="n">attention_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">)(</span><span class="n">query</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">filters</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Conv2DTranspose</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),)(</span><span class="n">x</span><span class="p">)</span><span class="c1">### Upsampling</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">res_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="n">n_groups</span><span class="p">,</span><span class="n">temb</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="p">)(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Define the model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">([</span><span class="n">input_1</span><span class="p">,</span><span class="n">input_2</span><span class="p">],</span> <span class="n">outputs</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;unet&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="n">model</span><span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">im_shape</span><span class="o">=</span><span class="n">IM_SHAPE</span><span class="p">,</span><span class="n">n_resnets</span><span class="o">=</span><span class="n">N_RESNETS</span><span class="p">,</span><span class="n">n_groups</span><span class="o">=</span><span class="n">N_GROUPS</span><span class="p">,</span><span class="n">attn_dim</span><span class="o">=</span><span class="n">ATTN_DIM</span><span class="p">,</span><span class="n">n_heads</span><span class="o">=</span><span class="n">N_HEADS</span><span class="p">,)</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;unet&quot;
__________________________________________________________________________________________________
 Layer (type)                Output Shape                 Param #   Connected to                  
==================================================================================================
 input_2 (InputLayer)        [(None,)]                    0         []                            
                                                                                                  
 positional_embeddings (Pos  (None, 512)                  0         [&#39;input_2[0][0]&#39;]             
 itionalEmbeddings)                                                                               
                                                                                                  
 dense_1 (Dense)             (None, 512)                  262656    [&#39;positional_embeddings[0][0]&#39;
                                                                    ]                             
                                                                                                  
 tf.nn.gelu (TFOpLambda)     (None, 512)                  0         [&#39;dense_1[0][0]&#39;]             
                                                                                                  
 dense (Dense)               (None, 512)                  262656    [&#39;tf.nn.gelu[0][0]&#39;]          
                                                                                                  
 input_1 (InputLayer)        [(None, 32, 32, 3)]          0         []                            
                                                                                                  
 tf.nn.silu (TFOpLambda)     (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 conv2d (Conv2D)             (None, 32, 32, 32)           896       [&#39;input_1[0][0]&#39;]             
                                                                                                  
 dense_2 (Dense)             (None, 32)                   16416     [&#39;tf.nn.silu[0][0]&#39;]          
                                                                                                  
 conv2d_1 (Conv2D)           (None, 32, 32, 32)           9248      [&#39;conv2d[0][0]&#39;]              
                                                                                                  
 tf.__operators__.getitem (  (None, 1, 1, 32)             0         [&#39;dense_2[0][0]&#39;]             
 SlicingOpLambda)                                                                                 
                                                                                                  
 tf.__operators__.add (TFOp  (None, 32, 32, 32)           0         [&#39;conv2d_1[0][0]&#39;,            
 Lambda)                                                             &#39;tf.__operators__.getitem[0][
                                                                    0]&#39;]                          
                                                                                                  
 group_normalization (Group  (None, 32, 32, 32)           64        [&#39;tf.__operators__.add[0][0]&#39;]
 Normalization)                                                                                   
                                                                                                  
 tf.nn.silu_1 (TFOpLambda)   (None, 32, 32, 32)           0         [&#39;group_normalization[0][0]&#39;] 
                                                                                                  
 conv2d_2 (Conv2D)           (None, 32, 32, 32)           9248      [&#39;tf.nn.silu_1[0][0]&#39;]        
                                                                                                  
 conv2d_3 (Conv2D)           (None, 32, 32, 32)           1056      [&#39;conv2d[0][0]&#39;]              
                                                                                                  
 tf.nn.silu_2 (TFOpLambda)   (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add (Add)                   (None, 32, 32, 32)           0         [&#39;conv2d_2[0][0]&#39;,            
                                                                     &#39;conv2d_3[0][0]&#39;]            
                                                                                                  
 dense_3 (Dense)             (None, 32)                   16416     [&#39;tf.nn.silu_2[0][0]&#39;]        
                                                                                                  
 conv2d_4 (Conv2D)           (None, 32, 32, 32)           9248      [&#39;add[0][0]&#39;]                 
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 32)             0         [&#39;dense_3[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_1 (TF  (None, 32, 32, 32)           0         [&#39;conv2d_4[0][0]&#39;,            
 OpLambda)                                                           &#39;tf.__operators__.getitem_1[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_1 (Gro  (None, 32, 32, 32)           64        [&#39;tf.__operators__.add_1[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_3 (TFOpLambda)   (None, 32, 32, 32)           0         [&#39;group_normalization_1[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_5 (Conv2D)           (None, 32, 32, 32)           9248      [&#39;tf.nn.silu_3[0][0]&#39;]        
                                                                                                  
 conv2d_6 (Conv2D)           (None, 32, 32, 32)           1056      [&#39;add[0][0]&#39;]                 
                                                                                                  
 add_1 (Add)                 (None, 32, 32, 32)           0         [&#39;conv2d_5[0][0]&#39;,            
                                                                     &#39;conv2d_6[0][0]&#39;]            
                                                                                                  
 tf.nn.silu_4 (TFOpLambda)   (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 max_pooling2d (MaxPooling2  (None, 16, 16, 32)           0         [&#39;add_1[0][0]&#39;]               
 D)                                                                                               
                                                                                                  
 dense_4 (Dense)             (None, 64)                   32832     [&#39;tf.nn.silu_4[0][0]&#39;]        
                                                                                                  
 conv2d_7 (Conv2D)           (None, 16, 16, 64)           18496     [&#39;max_pooling2d[0][0]&#39;]       
                                                                                                  
 tf.__operators__.getitem_2  (None, 1, 1, 64)             0         [&#39;dense_4[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_2 (TF  (None, 16, 16, 64)           0         [&#39;conv2d_7[0][0]&#39;,            
 OpLambda)                                                           &#39;tf.__operators__.getitem_2[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_2 (Gro  (None, 16, 16, 64)           128       [&#39;tf.__operators__.add_2[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_5 (TFOpLambda)   (None, 16, 16, 64)           0         [&#39;group_normalization_2[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_8 (Conv2D)           (None, 16, 16, 64)           36928     [&#39;tf.nn.silu_5[0][0]&#39;]        
                                                                                                  
 conv2d_9 (Conv2D)           (None, 16, 16, 64)           2112      [&#39;max_pooling2d[0][0]&#39;]       
                                                                                                  
 add_2 (Add)                 (None, 16, 16, 64)           0         [&#39;conv2d_8[0][0]&#39;,            
                                                                     &#39;conv2d_9[0][0]&#39;]            
                                                                                                  
 multi_head_attention (Mult  (None, 16, 16, 64)           530496    [&#39;add_2[0][0]&#39;,               
 iHeadAttention)                                                     &#39;add_2[0][0]&#39;]               
                                                                                                  
 tf.nn.silu_6 (TFOpLambda)   (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 group_normalization_3 (Gro  (None, 16, 16, 64)           128       [&#39;multi_head_attention[0][0]&#39;]
 upNormalization)                                                                                 
                                                                                                  
 dense_5 (Dense)             (None, 64)                   32832     [&#39;tf.nn.silu_6[0][0]&#39;]        
                                                                                                  
 conv2d_10 (Conv2D)          (None, 16, 16, 64)           36928     [&#39;group_normalization_3[0][0]&#39;
                                                                    ]                             
                                                                                                  
 tf.__operators__.getitem_3  (None, 1, 1, 64)             0         [&#39;dense_5[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_3 (TF  (None, 16, 16, 64)           0         [&#39;conv2d_10[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_3[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_4 (Gro  (None, 16, 16, 64)           128       [&#39;tf.__operators__.add_3[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_7 (TFOpLambda)   (None, 16, 16, 64)           0         [&#39;group_normalization_4[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_11 (Conv2D)          (None, 16, 16, 64)           36928     [&#39;tf.nn.silu_7[0][0]&#39;]        
                                                                                                  
 conv2d_12 (Conv2D)          (None, 16, 16, 64)           4160      [&#39;group_normalization_3[0][0]&#39;
                                                                    ]                             
                                                                                                  
 add_3 (Add)                 (None, 16, 16, 64)           0         [&#39;conv2d_11[0][0]&#39;,           
                                                                     &#39;conv2d_12[0][0]&#39;]           
                                                                                                  
 multi_head_attention_1 (Mu  (None, 16, 16, 64)           530496    [&#39;add_3[0][0]&#39;,               
 ltiHeadAttention)                                                   &#39;add_3[0][0]&#39;]               
                                                                                                  
 group_normalization_5 (Gro  (None, 16, 16, 64)           128       [&#39;multi_head_attention_1[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_8 (TFOpLambda)   (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 max_pooling2d_1 (MaxPoolin  (None, 8, 8, 64)             0         [&#39;group_normalization_5[0][0]&#39;
 g2D)                                                               ]                             
                                                                                                  
 dense_6 (Dense)             (None, 128)                  65664     [&#39;tf.nn.silu_8[0][0]&#39;]        
                                                                                                  
 conv2d_13 (Conv2D)          (None, 8, 8, 128)            73856     [&#39;max_pooling2d_1[0][0]&#39;]     
                                                                                                  
 tf.__operators__.getitem_4  (None, 1, 1, 128)            0         [&#39;dense_6[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_4 (TF  (None, 8, 8, 128)            0         [&#39;conv2d_13[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_4[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_6 (Gro  (None, 8, 8, 128)            256       [&#39;tf.__operators__.add_4[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_9 (TFOpLambda)   (None, 8, 8, 128)            0         [&#39;group_normalization_6[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_14 (Conv2D)          (None, 8, 8, 128)            147584    [&#39;tf.nn.silu_9[0][0]&#39;]        
                                                                                                  
 conv2d_15 (Conv2D)          (None, 8, 8, 128)            8320      [&#39;max_pooling2d_1[0][0]&#39;]     
                                                                                                  
 tf.nn.silu_10 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add_4 (Add)                 (None, 8, 8, 128)            0         [&#39;conv2d_14[0][0]&#39;,           
                                                                     &#39;conv2d_15[0][0]&#39;]           
                                                                                                  
 dense_7 (Dense)             (None, 128)                  65664     [&#39;tf.nn.silu_10[0][0]&#39;]       
                                                                                                  
 conv2d_16 (Conv2D)          (None, 8, 8, 128)            147584    [&#39;add_4[0][0]&#39;]               
                                                                                                  
 tf.__operators__.getitem_5  (None, 1, 1, 128)            0         [&#39;dense_7[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_5 (TF  (None, 8, 8, 128)            0         [&#39;conv2d_16[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_5[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_7 (Gro  (None, 8, 8, 128)            256       [&#39;tf.__operators__.add_5[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_11 (TFOpLambda)  (None, 8, 8, 128)            0         [&#39;group_normalization_7[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_17 (Conv2D)          (None, 8, 8, 128)            147584    [&#39;tf.nn.silu_11[0][0]&#39;]       
                                                                                                  
 conv2d_18 (Conv2D)          (None, 8, 8, 128)            16512     [&#39;add_4[0][0]&#39;]               
                                                                                                  
 add_5 (Add)                 (None, 8, 8, 128)            0         [&#39;conv2d_17[0][0]&#39;,           
                                                                     &#39;conv2d_18[0][0]&#39;]           
                                                                                                  
 tf.nn.silu_12 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 max_pooling2d_2 (MaxPoolin  (None, 4, 4, 128)            0         [&#39;add_5[0][0]&#39;]               
 g2D)                                                                                             
                                                                                                  
 dense_8 (Dense)             (None, 256)                  131328    [&#39;tf.nn.silu_12[0][0]&#39;]       
                                                                                                  
 conv2d_19 (Conv2D)          (None, 4, 4, 256)            295168    [&#39;max_pooling2d_2[0][0]&#39;]     
                                                                                                  
 tf.__operators__.getitem_6  (None, 1, 1, 256)            0         [&#39;dense_8[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_6 (TF  (None, 4, 4, 256)            0         [&#39;conv2d_19[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_6[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_8 (Gro  (None, 4, 4, 256)            512       [&#39;tf.__operators__.add_6[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_13 (TFOpLambda)  (None, 4, 4, 256)            0         [&#39;group_normalization_8[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_20 (Conv2D)          (None, 4, 4, 256)            590080    [&#39;tf.nn.silu_13[0][0]&#39;]       
                                                                                                  
 conv2d_21 (Conv2D)          (None, 4, 4, 256)            33024     [&#39;max_pooling2d_2[0][0]&#39;]     
                                                                                                  
 tf.nn.silu_14 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add_6 (Add)                 (None, 4, 4, 256)            0         [&#39;conv2d_20[0][0]&#39;,           
                                                                     &#39;conv2d_21[0][0]&#39;]           
                                                                                                  
 dense_9 (Dense)             (None, 256)                  131328    [&#39;tf.nn.silu_14[0][0]&#39;]       
                                                                                                  
 conv2d_22 (Conv2D)          (None, 4, 4, 256)            590080    [&#39;add_6[0][0]&#39;]               
                                                                                                  
 tf.__operators__.getitem_7  (None, 1, 1, 256)            0         [&#39;dense_9[0][0]&#39;]             
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_7 (TF  (None, 4, 4, 256)            0         [&#39;conv2d_22[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_7[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_9 (Gro  (None, 4, 4, 256)            512       [&#39;tf.__operators__.add_7[0][0]
 upNormalization)                                                   &#39;]                            
                                                                                                  
 tf.nn.silu_15 (TFOpLambda)  (None, 4, 4, 256)            0         [&#39;group_normalization_9[0][0]&#39;
                                                                    ]                             
                                                                                                  
 conv2d_23 (Conv2D)          (None, 4, 4, 256)            590080    [&#39;tf.nn.silu_15[0][0]&#39;]       
                                                                                                  
 conv2d_24 (Conv2D)          (None, 4, 4, 256)            65792     [&#39;add_6[0][0]&#39;]               
                                                                                                  
 add_7 (Add)                 (None, 4, 4, 256)            0         [&#39;conv2d_23[0][0]&#39;,           
                                                                     &#39;conv2d_24[0][0]&#39;]           
                                                                                                  
 tf.nn.silu_16 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 max_pooling2d_3 (MaxPoolin  (None, 2, 2, 256)            0         [&#39;add_7[0][0]&#39;]               
 g2D)                                                                                             
                                                                                                  
 dense_10 (Dense)            (None, 256)                  131328    [&#39;tf.nn.silu_16[0][0]&#39;]       
                                                                                                  
 conv2d_25 (Conv2D)          (None, 2, 2, 256)            590080    [&#39;max_pooling2d_3[0][0]&#39;]     
                                                                                                  
 tf.__operators__.getitem_8  (None, 1, 1, 256)            0         [&#39;dense_10[0][0]&#39;]            
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_8 (TF  (None, 2, 2, 256)            0         [&#39;conv2d_25[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_8[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_10 (Gr  (None, 2, 2, 256)            512       [&#39;tf.__operators__.add_8[0][0]
 oupNormalization)                                                  &#39;]                            
                                                                                                  
 tf.nn.silu_17 (TFOpLambda)  (None, 2, 2, 256)            0         [&#39;group_normalization_10[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_26 (Conv2D)          (None, 2, 2, 256)            590080    [&#39;tf.nn.silu_17[0][0]&#39;]       
                                                                                                  
 conv2d_27 (Conv2D)          (None, 2, 2, 256)            65792     [&#39;max_pooling2d_3[0][0]&#39;]     
                                                                                                  
 add_8 (Add)                 (None, 2, 2, 256)            0         [&#39;conv2d_26[0][0]&#39;,           
                                                                     &#39;conv2d_27[0][0]&#39;]           
                                                                                                  
 multi_head_attention_2 (Mu  (None, 2, 2, 256)            2103552   [&#39;add_8[0][0]&#39;,               
 ltiHeadAttention)                                                   &#39;add_8[0][0]&#39;]               
                                                                                                  
 tf.nn.silu_18 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 group_normalization_11 (Gr  (None, 2, 2, 256)            512       [&#39;multi_head_attention_2[0][0]
 oupNormalization)                                                  &#39;]                            
                                                                                                  
 dense_11 (Dense)            (None, 256)                  131328    [&#39;tf.nn.silu_18[0][0]&#39;]       
                                                                                                  
 conv2d_28 (Conv2D)          (None, 2, 2, 256)            590080    [&#39;group_normalization_11[0][0]
                                                                    &#39;]                            
                                                                                                  
 tf.__operators__.getitem_9  (None, 1, 1, 256)            0         [&#39;dense_11[0][0]&#39;]            
  (SlicingOpLambda)                                                                               
                                                                                                  
 tf.__operators__.add_9 (TF  (None, 2, 2, 256)            0         [&#39;conv2d_28[0][0]&#39;,           
 OpLambda)                                                           &#39;tf.__operators__.getitem_9[0
                                                                    ][0]&#39;]                        
                                                                                                  
 group_normalization_12 (Gr  (None, 2, 2, 256)            512       [&#39;tf.__operators__.add_9[0][0]
 oupNormalization)                                                  &#39;]                            
                                                                                                  
 tf.nn.silu_19 (TFOpLambda)  (None, 2, 2, 256)            0         [&#39;group_normalization_12[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_29 (Conv2D)          (None, 2, 2, 256)            590080    [&#39;tf.nn.silu_19[0][0]&#39;]       
                                                                                                  
 conv2d_30 (Conv2D)          (None, 2, 2, 256)            65792     [&#39;group_normalization_11[0][0]
                                                                    &#39;]                            
                                                                                                  
 add_9 (Add)                 (None, 2, 2, 256)            0         [&#39;conv2d_29[0][0]&#39;,           
                                                                     &#39;conv2d_30[0][0]&#39;]           
                                                                                                  
 tf.image.resize_with_pad (  (None, 4, 4, 256)            0         [&#39;add_9[0][0]&#39;]               
 TFOpLambda)                                                                                      
                                                                                                  
 tf.nn.silu_20 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 tf.concat (TFOpLambda)      (None, 4, 4, 512)            0         [&#39;tf.image.resize_with_pad[0][
                                                                    0]&#39;,                          
                                                                     &#39;add_7[0][0]&#39;]               
                                                                                                  
 dense_12 (Dense)            (None, 256)                  131328    [&#39;tf.nn.silu_20[0][0]&#39;]       
                                                                                                  
 conv2d_31 (Conv2D)          (None, 4, 4, 256)            1179904   [&#39;tf.concat[0][0]&#39;]           
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 256)            0         [&#39;dense_12[0][0]&#39;]            
 0 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_10 (T  (None, 4, 4, 256)            0         [&#39;conv2d_31[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_10[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_13 (Gr  (None, 4, 4, 256)            512       [&#39;tf.__operators__.add_10[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_21 (TFOpLambda)  (None, 4, 4, 256)            0         [&#39;group_normalization_13[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_32 (Conv2D)          (None, 4, 4, 256)            590080    [&#39;tf.nn.silu_21[0][0]&#39;]       
                                                                                                  
 conv2d_33 (Conv2D)          (None, 4, 4, 256)            131328    [&#39;tf.concat[0][0]&#39;]           
                                                                                                  
 tf.nn.silu_22 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add_10 (Add)                (None, 4, 4, 256)            0         [&#39;conv2d_32[0][0]&#39;,           
                                                                     &#39;conv2d_33[0][0]&#39;]           
                                                                                                  
 dense_13 (Dense)            (None, 256)                  131328    [&#39;tf.nn.silu_22[0][0]&#39;]       
                                                                                                  
 conv2d_34 (Conv2D)          (None, 4, 4, 256)            590080    [&#39;add_10[0][0]&#39;]              
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 256)            0         [&#39;dense_13[0][0]&#39;]            
 1 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_11 (T  (None, 4, 4, 256)            0         [&#39;conv2d_34[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_11[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_14 (Gr  (None, 4, 4, 256)            512       [&#39;tf.__operators__.add_11[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_23 (TFOpLambda)  (None, 4, 4, 256)            0         [&#39;group_normalization_14[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_35 (Conv2D)          (None, 4, 4, 256)            590080    [&#39;tf.nn.silu_23[0][0]&#39;]       
                                                                                                  
 conv2d_36 (Conv2D)          (None, 4, 4, 256)            65792     [&#39;add_10[0][0]&#39;]              
                                                                                                  
 add_11 (Add)                (None, 4, 4, 256)            0         [&#39;conv2d_35[0][0]&#39;,           
                                                                     &#39;conv2d_36[0][0]&#39;]           
                                                                                                  
 conv2d_transpose (Conv2DTr  (None, 9, 9, 256)            590080    [&#39;add_11[0][0]&#39;]              
 anspose)                                                                                         
                                                                                                  
 tf.image.resize_with_pad_1  (None, 8, 8, 256)            0         [&#39;conv2d_transpose[0][0]&#39;]    
  (TFOpLambda)                                                                                    
                                                                                                  
 tf.nn.silu_24 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 tf.concat_1 (TFOpLambda)    (None, 8, 8, 384)            0         [&#39;tf.image.resize_with_pad_1[0
                                                                    ][0]&#39;,                        
                                                                     &#39;add_5[0][0]&#39;]               
                                                                                                  
 dense_14 (Dense)            (None, 128)                  65664     [&#39;tf.nn.silu_24[0][0]&#39;]       
                                                                                                  
 conv2d_37 (Conv2D)          (None, 8, 8, 128)            442496    [&#39;tf.concat_1[0][0]&#39;]         
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 128)            0         [&#39;dense_14[0][0]&#39;]            
 2 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_12 (T  (None, 8, 8, 128)            0         [&#39;conv2d_37[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_12[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_15 (Gr  (None, 8, 8, 128)            256       [&#39;tf.__operators__.add_12[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_25 (TFOpLambda)  (None, 8, 8, 128)            0         [&#39;group_normalization_15[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_38 (Conv2D)          (None, 8, 8, 128)            147584    [&#39;tf.nn.silu_25[0][0]&#39;]       
                                                                                                  
 conv2d_39 (Conv2D)          (None, 8, 8, 128)            49280     [&#39;tf.concat_1[0][0]&#39;]         
                                                                                                  
 tf.nn.silu_26 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add_12 (Add)                (None, 8, 8, 128)            0         [&#39;conv2d_38[0][0]&#39;,           
                                                                     &#39;conv2d_39[0][0]&#39;]           
                                                                                                  
 dense_15 (Dense)            (None, 128)                  65664     [&#39;tf.nn.silu_26[0][0]&#39;]       
                                                                                                  
 conv2d_40 (Conv2D)          (None, 8, 8, 128)            147584    [&#39;add_12[0][0]&#39;]              
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 128)            0         [&#39;dense_15[0][0]&#39;]            
 3 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_13 (T  (None, 8, 8, 128)            0         [&#39;conv2d_40[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_13[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_16 (Gr  (None, 8, 8, 128)            256       [&#39;tf.__operators__.add_13[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_27 (TFOpLambda)  (None, 8, 8, 128)            0         [&#39;group_normalization_16[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_41 (Conv2D)          (None, 8, 8, 128)            147584    [&#39;tf.nn.silu_27[0][0]&#39;]       
                                                                                                  
 conv2d_42 (Conv2D)          (None, 8, 8, 128)            16512     [&#39;add_12[0][0]&#39;]              
                                                                                                  
 add_13 (Add)                (None, 8, 8, 128)            0         [&#39;conv2d_41[0][0]&#39;,           
                                                                     &#39;conv2d_42[0][0]&#39;]           
                                                                                                  
 conv2d_transpose_1 (Conv2D  (None, 17, 17, 128)          147584    [&#39;add_13[0][0]&#39;]              
 Transpose)                                                                                       
                                                                                                  
 tf.image.resize_with_pad_2  (None, 16, 16, 128)          0         [&#39;conv2d_transpose_1[0][0]&#39;]  
  (TFOpLambda)                                                                                    
                                                                                                  
 tf.nn.silu_28 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 tf.concat_2 (TFOpLambda)    (None, 16, 16, 192)          0         [&#39;tf.image.resize_with_pad_2[0
                                                                    ][0]&#39;,                        
                                                                     &#39;group_normalization_5[0][0]&#39;
                                                                    ]                             
                                                                                                  
 dense_16 (Dense)            (None, 64)                   32832     [&#39;tf.nn.silu_28[0][0]&#39;]       
                                                                                                  
 conv2d_43 (Conv2D)          (None, 16, 16, 64)           110656    [&#39;tf.concat_2[0][0]&#39;]         
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 64)             0         [&#39;dense_16[0][0]&#39;]            
 4 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_14 (T  (None, 16, 16, 64)           0         [&#39;conv2d_43[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_14[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_17 (Gr  (None, 16, 16, 64)           128       [&#39;tf.__operators__.add_14[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_29 (TFOpLambda)  (None, 16, 16, 64)           0         [&#39;group_normalization_17[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_44 (Conv2D)          (None, 16, 16, 64)           36928     [&#39;tf.nn.silu_29[0][0]&#39;]       
                                                                                                  
 conv2d_45 (Conv2D)          (None, 16, 16, 64)           12352     [&#39;tf.concat_2[0][0]&#39;]         
                                                                                                  
 add_14 (Add)                (None, 16, 16, 64)           0         [&#39;conv2d_44[0][0]&#39;,           
                                                                     &#39;conv2d_45[0][0]&#39;]           
                                                                                                  
 multi_head_attention_3 (Mu  (None, 16, 16, 64)           530496    [&#39;add_14[0][0]&#39;,              
 ltiHeadAttention)                                                   &#39;add_14[0][0]&#39;]              
                                                                                                  
 tf.nn.silu_30 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 group_normalization_18 (Gr  (None, 16, 16, 64)           128       [&#39;multi_head_attention_3[0][0]
 oupNormalization)                                                  &#39;]                            
                                                                                                  
 dense_17 (Dense)            (None, 64)                   32832     [&#39;tf.nn.silu_30[0][0]&#39;]       
                                                                                                  
 conv2d_46 (Conv2D)          (None, 16, 16, 64)           36928     [&#39;group_normalization_18[0][0]
                                                                    &#39;]                            
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 64)             0         [&#39;dense_17[0][0]&#39;]            
 5 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_15 (T  (None, 16, 16, 64)           0         [&#39;conv2d_46[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_15[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_19 (Gr  (None, 16, 16, 64)           128       [&#39;tf.__operators__.add_15[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_31 (TFOpLambda)  (None, 16, 16, 64)           0         [&#39;group_normalization_19[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_47 (Conv2D)          (None, 16, 16, 64)           36928     [&#39;tf.nn.silu_31[0][0]&#39;]       
                                                                                                  
 conv2d_48 (Conv2D)          (None, 16, 16, 64)           4160      [&#39;group_normalization_18[0][0]
                                                                    &#39;]                            
                                                                                                  
 add_15 (Add)                (None, 16, 16, 64)           0         [&#39;conv2d_47[0][0]&#39;,           
                                                                     &#39;conv2d_48[0][0]&#39;]           
                                                                                                  
 multi_head_attention_4 (Mu  (None, 16, 16, 64)           530496    [&#39;add_15[0][0]&#39;,              
 ltiHeadAttention)                                                   &#39;add_15[0][0]&#39;]              
                                                                                                  
 group_normalization_20 (Gr  (None, 16, 16, 64)           128       [&#39;multi_head_attention_4[0][0]
 oupNormalization)                                                  &#39;]                            
                                                                                                  
 conv2d_transpose_2 (Conv2D  (None, 33, 33, 64)           36928     [&#39;group_normalization_20[0][0]
 Transpose)                                                         &#39;]                            
                                                                                                  
 tf.image.resize_with_pad_3  (None, 32, 32, 64)           0         [&#39;conv2d_transpose_2[0][0]&#39;]  
  (TFOpLambda)                                                                                    
                                                                                                  
 tf.nn.silu_32 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 tf.concat_3 (TFOpLambda)    (None, 32, 32, 96)           0         [&#39;tf.image.resize_with_pad_3[0
                                                                    ][0]&#39;,                        
                                                                     &#39;add_1[0][0]&#39;]               
                                                                                                  
 dense_18 (Dense)            (None, 32)                   16416     [&#39;tf.nn.silu_32[0][0]&#39;]       
                                                                                                  
 conv2d_49 (Conv2D)          (None, 32, 32, 32)           27680     [&#39;tf.concat_3[0][0]&#39;]         
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 32)             0         [&#39;dense_18[0][0]&#39;]            
 6 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_16 (T  (None, 32, 32, 32)           0         [&#39;conv2d_49[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_16[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_21 (Gr  (None, 32, 32, 32)           64        [&#39;tf.__operators__.add_16[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_33 (TFOpLambda)  (None, 32, 32, 32)           0         [&#39;group_normalization_21[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_50 (Conv2D)          (None, 32, 32, 32)           9248      [&#39;tf.nn.silu_33[0][0]&#39;]       
                                                                                                  
 conv2d_51 (Conv2D)          (None, 32, 32, 32)           3104      [&#39;tf.concat_3[0][0]&#39;]         
                                                                                                  
 tf.nn.silu_34 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add_16 (Add)                (None, 32, 32, 32)           0         [&#39;conv2d_50[0][0]&#39;,           
                                                                     &#39;conv2d_51[0][0]&#39;]           
                                                                                                  
 dense_19 (Dense)            (None, 32)                   16416     [&#39;tf.nn.silu_34[0][0]&#39;]       
                                                                                                  
 conv2d_52 (Conv2D)          (None, 32, 32, 32)           9248      [&#39;add_16[0][0]&#39;]              
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 32)             0         [&#39;dense_19[0][0]&#39;]            
 7 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_17 (T  (None, 32, 32, 32)           0         [&#39;conv2d_52[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_17[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_22 (Gr  (None, 32, 32, 32)           64        [&#39;tf.__operators__.add_17[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_35 (TFOpLambda)  (None, 32, 32, 32)           0         [&#39;group_normalization_22[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_53 (Conv2D)          (None, 32, 32, 32)           9248      [&#39;tf.nn.silu_35[0][0]&#39;]       
                                                                                                  
 conv2d_54 (Conv2D)          (None, 32, 32, 32)           1056      [&#39;add_16[0][0]&#39;]              
                                                                                                  
 tf.nn.silu_36 (TFOpLambda)  (None, 512)                  0         [&#39;dense[0][0]&#39;]               
                                                                                                  
 add_17 (Add)                (None, 32, 32, 32)           0         [&#39;conv2d_53[0][0]&#39;,           
                                                                     &#39;conv2d_54[0][0]&#39;]           
                                                                                                  
 dense_20 (Dense)            (None, 32)                   16416     [&#39;tf.nn.silu_36[0][0]&#39;]       
                                                                                                  
 conv2d_55 (Conv2D)          (None, 32, 32, 32)           9248      [&#39;add_17[0][0]&#39;]              
                                                                                                  
 tf.__operators__.getitem_1  (None, 1, 1, 32)             0         [&#39;dense_20[0][0]&#39;]            
 8 (SlicingOpLambda)                                                                              
                                                                                                  
 tf.__operators__.add_18 (T  (None, 32, 32, 32)           0         [&#39;conv2d_55[0][0]&#39;,           
 FOpLambda)                                                          &#39;tf.__operators__.getitem_18[
                                                                    0][0]&#39;]                       
                                                                                                  
 group_normalization_23 (Gr  (None, 32, 32, 32)           64        [&#39;tf.__operators__.add_18[0][0
 oupNormalization)                                                  ]&#39;]                           
                                                                                                  
 tf.nn.silu_37 (TFOpLambda)  (None, 32, 32, 32)           0         [&#39;group_normalization_23[0][0]
                                                                    &#39;]                            
                                                                                                  
 conv2d_56 (Conv2D)          (None, 32, 32, 32)           9248      [&#39;tf.nn.silu_37[0][0]&#39;]       
                                                                                                  
 conv2d_57 (Conv2D)          (None, 32, 32, 32)           1056      [&#39;add_17[0][0]&#39;]              
                                                                                                  
 add_18 (Add)                (None, 32, 32, 32)           0         [&#39;conv2d_56[0][0]&#39;,           
                                                                     &#39;conv2d_57[0][0]&#39;]           
                                                                                                  
 conv2d_58 (Conv2D)          (None, 32, 32, 3)            867       [&#39;add_18[0][0]&#39;]              
                                                                                                  
==================================================================================================
Total params: 16584803 (63.27 MB)
Trainable params: 16584803 (63.27 MB)
Non-trainable params: 0 (0.00 Byte)
__________________________________________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LRSchedule</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">LearningRateSchedule</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_lr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_lr</span> <span class="o">=</span> <span class="n">init_lr</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_lr</span><span class="o">*</span><span class="p">(</span><span class="mi">100000</span><span class="o">/</span><span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">100000</span><span class="p">))</span>

<span class="n">OPTIMIZER</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">LRSchedule</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">custom_loss</span><span class="p">(</span><span class="n">denoise_model</span><span class="p">,</span> <span class="n">x_start</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1">### Our custom loss function takes in the predicted noise and compares (using the Huber Loss) it with the actual noise</span>
    <span class="c1">### Huber Loss with a default value for delta as 1.0 Check out the documentation: https://www.tensorflow.org/api_docs/python/tf/keras/losses/Huber</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">Huber</span><span class="p">()</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x_start</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">stddev</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1">### noise=epsilon=z</span>
    <span class="n">x_noisy</span> <span class="o">=</span> <span class="n">q_sample</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">noise</span><span class="p">)</span><span class="c1">### x_t using the q_sample method</span>
    <span class="n">predicted_noise</span> <span class="o">=</span> <span class="n">denoise_model</span><span class="p">([</span><span class="n">x_noisy</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span><span class="c1">### model takes in the x_t and t and outputs noise</span>
    <span class="k">return</span> <span class="n">h</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span><span class="n">predicted_noise</span><span class="p">)</span>

<span class="c1">### custom training block</span>
<span class="c1">### You can use tf.function to make graphs out of your programs. It is a transformation tool that creates Python-independent dataflow graphs</span>
<span class="c1">### out of your Python code. This will help you create performant and portable models.</span>
<span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">training_block</span><span class="p">(</span><span class="n">x_batch</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">recorder</span><span class="p">:</span>
        <span class="c1">### for every element in the batch, we generate t randomly</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">((</span><span class="n">BATCH_SIZE</span><span class="p">,),</span><span class="n">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">maxval</span><span class="o">=</span><span class="n">TIME_STEPS</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">custom_loss</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">x_batch</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>

    <span class="n">partial_derivatives</span> <span class="o">=</span> <span class="n">recorder</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">trainable_weights</span><span class="p">)</span>
    <span class="n">OPTIMIZER</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">partial_derivatives</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">trainable_weights</span><span class="p">))</span><span class="c1">### gradient descent</span>
    <span class="k">return</span> <span class="n">loss</span>

<span class="k">def</span> <span class="nf">neuralearn</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
        <span class="n">init_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">x_batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">):</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">training_block</span><span class="p">(</span><span class="n">x_batch</span><span class="p">)</span>
            <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;: Training Loss-----&gt;&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">losses</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time Elapsed: ---&gt; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">init_time</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; s&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Complete!!!!&quot;</span><span class="p">)</span>

<span class="n">neuralearn</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/10: Training Loss-----&gt; tf.Tensor(0.0851486, shape=(), dtype=float32)
Time Elapsed: ---&gt; 271.93567872047424 s
2/10: Training Loss-----&gt; tf.Tensor(0.03785207, shape=(), dtype=float32)
Time Elapsed: ---&gt; 225.90968680381775 s
3/10: Training Loss-----&gt; tf.Tensor(0.031987343, shape=(), dtype=float32)
Time Elapsed: ---&gt; 227.73545622825623 s
4/10: Training Loss-----&gt; tf.Tensor(0.028098105, shape=(), dtype=float32)
Time Elapsed: ---&gt; 225.87372756004333 s
5/10: Training Loss-----&gt; tf.Tensor(0.026988357, shape=(), dtype=float32)
Time Elapsed: ---&gt; 226.86771440505981 s
6/10: Training Loss-----&gt; tf.Tensor(0.026325967, shape=(), dtype=float32)
Time Elapsed: ---&gt; 226.94463539123535 s
7/10: Training Loss-----&gt; tf.Tensor(0.025573287, shape=(), dtype=float32)
Time Elapsed: ---&gt; 226.3922827243805 s
8/10: Training Loss-----&gt; tf.Tensor(0.025572365, shape=(), dtype=float32)
Time Elapsed: ---&gt; 227.60708856582642 s
9/10: Training Loss-----&gt; tf.Tensor(0.02489814, shape=(), dtype=float32)
Time Elapsed: ---&gt; 227.7055013179779 s
10/10: Training Loss-----&gt; tf.Tensor(0.023693103, shape=(), dtype=float32)
Time Elapsed: ---&gt; 228.3441195487976 s
Training Complete!!!!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt_recip_alphas</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">alphas</span><span class="p">)</span>
<span class="n">alphas_cumprod_prev</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span><span class="n">alphas_cumprod</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="c1">### alpha_t-1_bar = alphas_cumprod_prev</span>

<span class="n">posterior_variance</span> <span class="o">=</span> <span class="n">betas</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">alphas_cumprod_prev</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">alphas_cumprod</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">p_sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_index</span><span class="p">):</span>

    <span class="n">betas_t</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">betas</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="c1">### betas_t = 1-alphas_t</span>
    <span class="n">sqrt_one_minus_alphas_cumprod_t</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">sqrt_one_minus_alphas_cumprod</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="c1">### square root of 1-alpha_t_bar</span>
    <span class="n">sqrt_recip_alphas_t</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">sqrt_recip_alphas</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="c1">### 1/square root of alpha_t</span>

    <span class="n">model_mean</span> <span class="o">=</span> <span class="n">sqrt_recip_alphas_t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">betas_t</span> <span class="o">*</span> <span class="n">model</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span> <span class="o">/</span> <span class="n">sqrt_one_minus_alphas_cumprod_t</span><span class="p">)</span><span class="c1">### equation 4 of algorithm 2 above</span>

    <span class="k">if</span> <span class="n">t_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model_mean</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">posterior_variance_t</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">posterior_variance</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="c1">### sigma_t</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_mean</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">posterior_variance_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span>

<span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">64</span><span class="p">,</span><span class="n">IM_SHAPE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">IM_SHAPE</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">IM_SHAPE</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TIME_STEPS</span><span class="p">)):</span><span class="c1">### we go backwards from t = 1000 to t = 0</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">p_sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">tf</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span><span class="n">i</span><span class="p">,),</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="mi">999</span><span class="p">])[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>999
998
997
996
995
994
993
992
991
990
989
988
987
986
985
984
983
982
981
980
979
978
977
976
975
974
973
972
971
970
969
968
967
966
965
964
963
962
961
960
959
958
957
956
955
954
953
952
951
950
949
948
947
946
945
944
943
942
941
940
939
938
937
936
935
934
933
932
931
930
929
928
927
926
925
924
923
922
921
920
919
918
917
916
915
914
913
912
911
910
909
908
907
906
905
904
903
902
901
900
899
898
897
896
895
894
893
892
891
890
889
888
887
886
885
884
883
882
881
880
879
878
877
876
875
874
873
872
871
870
869
868
867
866
865
864
863
862
861
860
859
858
857
856
855
854
853
852
851
850
849
848
847
846
845
844
843
842
841
840
839
838
837
836
835
834
833
832
831
830
829
828
827
826
825
824
823
822
821
820
819
818
817
816
815
814
813
812
811
810
809
808
807
806
805
804
803
802
801
800
799
798
797
796
795
794
793
792
791
790
789
788
787
786
785
784
783
782
781
780
779
778
777
776
775
774
773
772
771
770
769
768
767
766
765
764
763
762
761
760
759
758
757
756
755
754
753
752
751
750
749
748
747
746
745
744
743
742
741
740
739
738
737
736
735
734
733
732
731
730
729
728
727
726
725
724
723
722
721
720
719
718
717
716
715
714
713
712
711
710
709
708
707
706
705
704
703
702
701
700
699
698
697
696
695
694
693
692
691
690
689
688
687
686
685
684
683
682
681
680
679
678
677
676
675
674
673
672
671
670
669
668
667
666
665
664
663
662
661
660
659
658
657
656
655
654
653
652
651
650
649
648
647
646
645
644
643
642
641
640
639
638
637
636
635
634
633
632
631
630
629
628
627
626
625
624
623
622
621
620
619
618
617
616
615
614
613
612
611
610
609
608
607
606
605
604
603
602
601
600
599
598
597
596
595
594
593
592
591
590
589
588
587
586
585
584
583
582
581
580
579
578
577
576
575
574
573
572
571
570
569
568
567
566
565
564
563
562
561
560
559
558
557
556
555
554
553
552
551
550
549
548
547
546
545
544
543
542
541
540
539
538
537
536
535
534
533
532
531
530
529
528
527
526
525
524
523
522
521
520
519
518
517
516
515
514
513
512
511
510
509
508
507
506
505
504
503
502
501
500
499
498
497
496
495
494
493
492
491
490
489
488
487
486
485
484
483
482
481
480
479
478
477
476
475
474
473
472
471
470
469
468
467
466
465
464
463
462
461
460
459
458
457
456
455
454
453
452
451
450
449
448
447
446
445
444
443
442
441
440
439
438
437
436
435
434
433
432
431
430
429
428
427
426
425
424
423
422
421
420
419
418
417
416
415
414
413
412
411
410
409
408
407
406
405
404
403
402
401
400
399
398
397
396
395
394
393
392
391
390
389
388
387
386
385
384
383
382
381
380
379
378
377
376
375
374
373
372
371
370
369
368
367
366
365
364
363
362
361
360
359
358
357
356
355
354
353
352
351
350
349
348
347
346
345
344
343
342
341
340
339
338
337
336
335
334
333
332
331
330
329
328
327
326
325
324
323
322
321
320
319
318
317
316
315
314
313
312
311
310
309
308
307
306
305
304
303
302
301
300
299
298
297
296
295
294
293
292
291
290
289
288
287
286
285
284
283
282
281
280
279
278
277
276
275
274
273
272
271
270
269
268
267
266
265
264
263
262
261
260
259
258
257
256
255
254
253
252
251
250
249
248
247
246
245
244
243
242
241
240
239
238
237
236
235
234
233
232
231
230
229
228
227
226
225
224
223
222
221
220
219
218
217
216
215
214
213
212
211
210
209
208
207
206
205
204
203
202
201
200
199
198
197
196
195
194
193
192
191
190
189
188
187
186
185
184
183
182
181
180
179
178
177
176
175
174
173
172
171
170
169
168
167
166
165
164
163
162
161
160
159
158
157
156
155
154
153
152
151
150
149
148
147
146
145
144
143
142
141
140
139
138
137
136
135
134
133
132
131
130
129
128
127
126
125
124
123
122
121
120
119
118
117
116
115
114
113
112
111
110
109
108
107
106
105
104
103
102
101
100
99
98
97
96
95
94
93
92
91
90
89
88
87
86
85
84
83
82
81
80
79
78
77
76
75
74
73
72
71
70
69
68
67
66
65
64
63
62
61
60
59
58
57
56
55
54
53
52
51
50
49
48
47
46
45
44
43
42
41
40
39
38
37
36
35
34
33
32
31
30
29
28
27
26
25
24
23
22
21
20
19
18
17
16
15
14
13
12
11
10
9
8
7
6
5
4
3
2
1
0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../../_images/a0caa802fd87126611e5b2d32c6e7cc30ff6a31faea1e41f915d74771df0ed5f.png" src="../../_images/a0caa802fd87126611e5b2d32c6e7cc30ff6a31faea1e41f915d74771df0ed5f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ims</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TIME_STEPS</span><span class="p">):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="n">random_index</span><span class="p">],</span> <span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">im</span><span class="p">])</span>
    <span class="n">ims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">im</span><span class="p">])</span>

<span class="n">animate</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">ArtistAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ims</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">repeat_delay</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">animate</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;diffusion.gif&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
WARNING:matplotlib.image:Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre></div>
</div>
<img alt="../../_images/38e311b874a0e855ca99ef793ef834842e36d9e136da70c3bc55a02bc22acbd9.png" src="../../_images/38e311b874a0e855ca99ef793ef834842e36d9e136da70c3bc55a02bc22acbd9.png" />
</div>
</div>
</section>
</section>
<section id="your-turn">
<h2><span class="section-number">3.4. </span>Your turn! üöÄ<a class="headerlink" href="#your-turn" title="Link to this heading">#</a></h2>
<p>Assignment - <a class="reference internal" href="../assignments/denoising-difussion-model.html"><span class="std std-doc">Denoising difussion model</span></a></p>
</section>
<section id="acknowledgments">
<h2><span class="section-number">3.5. </span>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Link to this heading">#</a></h2>
<p>Thanks to <a class="reference external" href="https://github.com/phykn">Kwangnam Yu</a> for creating the open-source project <a class="reference external" href="https://github.com/phykn/diffusion_models_tutorial">diffusion_models_tutorial</a> and <a class="reference external" href="https://www.kaggle.com/">kaggle</a> for creating the open-source courses <a class="reference external" href="https://www.kaggle.com/code/folefac/denoising-diffusion-models-with-tensorflow#3.-The-Celeb-A-Dataset-%F0%9F%92%BE">Denoising Diffusion Models with TensorFlow</a><a class="reference external" href="https://www.kaggle.com/code/darshan1504/exploring-diffusion-models-with-jax">Exploring Diffusion Models with JAX</a><a class="reference external" href="https://www.kaggle.com/code/junhyeok99/denoising-diffusion-probabilistic-model-with-tf#Mathematics-&amp;amp;-Workflow">Denoising Diffusion Probabilistic Model with TF</a>. They inspire the majority of the content in this chapter.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book/generation-model"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="gan.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Generative adversarial networks</p>
      </div>
    </a>
    <a class="right-next"
       href="../assignments/art-by-gan.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Art by gan</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2. Diffusion Model</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">2.1. Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expectation">2.1.1. Expectation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#definition">2.1.1.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#properties">2.1.1.2. Properties</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variance">2.1.2. Variance</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1.2.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1.2.2. Properties</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#re-parameterization-trick">2.1.3. Re-parameterization trick</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-expectation">2.1.3.1. Mean (Expectation)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.1.3.2. Variance</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kl-divergence">2.1.4. KL Divergence</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.1.4.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#jensen-s-inequality">2.1.4.2. Jensen‚Äôs inequality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-kl-divergence">2.1.4.3. Properties of KL Divergence</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evidence-lower-bound-elbo">2.1.5. Evidence lower bound (ELBO)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.1.5.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.1.5.2. Properties</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-and-reverse-process">3. Forward and Reverse Process</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-diffusion-process">3.1. Forward Diffusion Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reverse-diffusion-process">3.2. Reverse Diffusion Process</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loss-function">3.2.1. Loss Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#noise-schedule">3.2.2. Noise schedule</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-schedule">3.2.2.1. Linear schedule</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cosine-schedule">3.2.2.2. Cosine schedule</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code">3.3. Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">3.3.1. Import Libraries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-loading">3.3.2. Data Loading</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">3.3.3. Data Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-augmentation">3.3.4. Data Augmentation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">3.3.5. Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-schedule-beta">3.3.6. Linear schedule-beta</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-turn">3.4. Your turn! üöÄ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgments">3.5. Acknowledgments</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By anyiyou
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>